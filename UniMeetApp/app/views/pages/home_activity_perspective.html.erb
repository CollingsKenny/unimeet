<body>
  <% if user_signed_in? %>
  <canvas id="canvas"></canvas>
  <div class = "row d-flex">
    <div class = "col-md-3 d-none d-md-block sidebar">
      <div class = "sidebar-sticky">
        <ul class="nav nav-tabs" id="myTab" role="tablist" class="row">
          <li class="nav-item col-6">
            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Matches</a>
          </li>
          <li class="nav-item col-6">
            <a class="nav-link" id="activities-tab" data-toggle="tab" href="#my-activities" role="tab" aria-controls="profile" aria-selected="false">Activities</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <% profiles = User.joins(:matches).where({ "matches.activity_id" => session[:current_activity_id]}) %>
          <% profiles.each do |profile| %>
            <%= link_to({action: "show_profile_card", controller: "pages", id: profile.id, method: :get, :remote => true}, class: "nav-link p-0") do %>
            <div class= "nav flex-row activity-row p-2">
              <div class = "col-2">
                <%= display_activity_image(profile,:thumb, "rounded-circle") %>
              </div>
              <div class = "col-10">
                <h4><%= profile.first_name%></h4>
                <h5><span class="card-title btn btn-dark ml"><%= profile.major%></span><span class="card-title btn btn-warning mr">    <%= profile.college_location%></span></h5>
              </div>
            </div>
            <% end %>
          <% end %>
          </div>
          <div class="tab-pane fade" id="my-activities" role="tabpanel" aria-labelledby="profile-tab">
            <% activity = Activity.joins(:memberships).where({ "memberships.ownership" => true, "memberships.user_id" => current_user.id}) %>
            <% activity.each do |activ| %>
            <div class= "nav flex-row activity-row p-2">
              <div class = "col-2">
                <%= image_tag(activ.image.url(:thumb), :class => "rounded-circle") %>
              </div>
              <div class = "col-10">
                <h4><%= activ.name%></h4>
                <p><%= activ.description%></p>
              </div>
            </div>
            <% end %>
          </div>
          
        </div>  
        
        
        
        
        
      </div>
    </div>
    <div class = "col-md-9 ml-sm-auto pt-5 px-auto justify-content-center">

      <div class = "col-5 mx-auto">
        <div id="card-container">
        <% all = User.all%>
            <% notWanted = User.where(id: User.joins(:memberships).where({ "memberships.activity_id" => session[:current_activity_id]})).or(User.where(id: User.joins(:likes).where({"likes.activity_id" => session[:current_activity_id]}).where.not("likes.activity_likes_user" => nil))) %>
            <% queue = all - notWanted %>
            <% nextUserInQueue = queue.first() %>
        <%= render "users/user_card", user: nextUserInQueue %>
        </div>
      </div>
    </div>
  </div>
  <% end %>
</body>
<!-- Modal -->
<div class="modal fade tada animated" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog tada animated" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">New Match!</h4>
      </div>
      <div class="modal-body">
        Congratulations, you have a new match!
      </div>
    </div>
  </div>
</div>
